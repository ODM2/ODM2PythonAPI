language: python
python:
#  - "2.6"
  - "2.7"
#  - "3.2"
#  - "3.3"
#  - "3.4"
#  - "3.5"
#  - "3.5-dev" # 3.5 development branch
#  - "nightly" # currently points to 3.6-dev
# command to install dependencies
services:
  #- mysql
  - postgresql
addons:
  mariadb: '10.1'
before_install:
  - mysql -e "create database IF NOT EXISTS odm2;" -uroot
  - mysql -e "create database IF NOT EXISTS odm2test;" -uroot
  - psql -U postgres -c "create extension postgis"
  - psql -c 'DROP DATABASE IF EXISTS odm2test;' -U postgres;
  - psql -c 'create database odm2test;' -U postgres;
#  - psql -U postgres -d odm2test -a -f ./tests/schemas/postgresql/ODM2_for_PostgreSQL.sql
  - psql -c 'DROP DATABASE IF EXISTS odm2;' -U postgres;
  - psql -c 'create database odm2;' -U postgres;
  # patterned after: https://github.com/ptrv/gpx2spatialite/blob/master/.travis.yml
  - sudo apt-get install -y python-software-properties
  - sudo apt-add-repository -y ppa:git-core/ppa
  - sudo apt-add-repository -y ppa:ubuntugis/ppa
  - sudo apt-get update -qq
  - sudo apt-get install unixodbc  unixodbc-dev tdsodbc
  - sudo apt-get install freetds-dev freetds-bin
  - sudo apt-get install libc6  e2fsprogs  # mssql driver
  # Spatialiate
  - sudo apt-get install -y libproj-dev libgeos-dev libspatialite-dev
  - sudo ln -s /usr/lib/x86_64-linux-gnu/libspatialite.so /usr/lib/libspatialite.so
#  - sudo apt-get install python-scipy python-matplotlib python-pandas python-sympy python-nose
  - sudo apt-get install python-matplotlib python-pandas python-nose
  - pip install pandas
install: # now just our code
  - pip install git+https://github.com/ODM2/geoalchemy.git@odm2#egg=geoalchemy-0.7.3
  - pip install .
  - pip install -r requirements_tests.txt  --allow-external pyodbc --allow-unverified pyodbc
    # pysqlite
  - pip install pysqlite
  - ls -l  ./tests/usecasesql/littlebearriver/sampledatabases/odm2_mysql/LBR_MySQL_SmallExample.sql ./tests/usecasesql/marchantariats/marchantariats.sql
  - mysql -uroot  odm2 < ./tests/usecasesql/littlebearriver/sampledatabases/odm2_mysql/LBR_MySQL_SmallExample.sql
  - psql -U postgres  -a -f ./tests/usecasesql/marchantariats/marchantariats.sql



# command to run tests
script:
# just the connection part
  - py.test tests/test_connection.py
  - py.test

